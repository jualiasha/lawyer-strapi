"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[8155],{89945:function(_e,N,a){a.r(N),a.d(N,{default:function(){return He}});var t=a(32735),D=a(92802),O=a(67879),R=a(15062),J=a(20108),v=a(24989),q=a(96709),_=a(27649),ee=a(82055),te=a(41415),ae=a(17e3),oe=a(97405),ne=a(66456),re=a(60216),g=a.n(re),I=a(8471),k=a(72850),h=a(87933),d=a(61937);function se({status:e,data:o}){return{type:d.QM,payload:{status:e,workflows:o}}}function le(e){return{type:d.x4,payload:{stageId:e}}}function ie(e={}){return{type:d.Ot,payload:e}}function U(e,o){return{type:d.Nj,payload:{stageId:e,...o}}}function de(e,o){return{type:d.$k,payload:{newIndex:o,oldIndex:e}}}var b=a(49372),ce=a(86308);const L=(0,I.ZP)(ce.Z)`
  > circle {
    fill: ${({theme:e})=>e.colors.neutral150};
  }
  > path {
    fill: ${({theme:e})=>e.colors.neutral600};
  }
`,ue=(0,I.ZP)(k.x)`
  border-radius: 26px;

  svg {
    height: ${({theme:e})=>e.spaces[6]};
    width: ${({theme:e})=>e.spaces[6]};

    > path {
      fill: ${({theme:e})=>e.colors.neutral600};
    }
  }

  &:hover {
    color: ${({theme:e})=>e.colors.primary600} !important;
    ${b.Z} {
      color: ${({theme:e})=>e.colors.primary600} !important;
    }

    ${L} {
      > circle {
        fill: ${({theme:e})=>e.colors.primary600};
      }
      > path {
        fill: ${({theme:e})=>e.colors.neutral100};
      }
    }
  }

  &:active {
    ${b.Z} {
      color: ${({theme:e})=>e.colors.primary600};
    }

    ${L} {
      > circle {
        fill: ${({theme:e})=>e.colors.primary600};
      }
      > path {
        fill: ${({theme:e})=>e.colors.neutral100};
      }
    }
  }
`;function G({children:e,...o}){return t.createElement(ue,{as:"button",background:"neutral0",border:"neutral150",paddingBottom:3,paddingLeft:4,paddingRight:4,paddingTop:3,shadow:"filterShadow",...o},t.createElement(h.k,{gap:2},t.createElement(L,{"aria-hidden":!0}),t.createElement(b.Z,{variant:"pi",fontWeight:"bold",textColor:"neutral500"},e)))}G.propTypes={children:g().node.isRequired};var ge=a(3685),me=a(83828),fe=a(61762),j=a(50563),ve=a(89966),pe=a(15335),z=a(5803),Se=a(10369),he=a(87107),we=a(28847),ye=a(47851),Ee=a(4038),ke=a(47081),Ce=a(12301);function et(e){const n=Object.entries(lightTheme.colors).filter(([,c])=>c===e).reduce((c,[s])=>(STAGE_COLORS?.[s]&&(c=s),c),null);return n?{themeColorName:n,name:STAGE_COLORS[n]}:null}function We(){return Object.entries(d.lv).map(([e,o])=>({hex:Ce.W.colors[e].toUpperCase(),name:o}))}var De=a(28315),Re=a(8445),Ie=a(56327),Me=a(95952);const $e=We();function Te(){return t.createElement(k.x,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",display:"block",hasRadius:!0,padding:6,shadow:"tableShadow"})}function H({id:e,index:o,canDelete:n,canReorder:c,isOpen:s=!1,stagesCount:l}){const r=i=>`${i+1} of ${l}`,m=i=>{y(u({id:"dnd.grab-item",defaultMessage:"{item}, grabbed. Current position in list: {position}. Press up and down arrow to change position, Spacebar to drop, Escape to cancel."},{item:p.value,position:r(i)}))},w=i=>{y(u({id:"dnd.drop-item",defaultMessage:"{item}, dropped. Final position in list: {position}."},{item:p.value,position:r(i)}))},C=()=>{y(u({id:"dnd.cancel-item",defaultMessage:"{item}, dropped. Re-order cancelled."},{item:p.value}))},P=(i,V)=>{y(u({id:"dnd.reorder",defaultMessage:"{item}, moved. New position in list: {position}."},{item:p.value,position:r(i)})),E(de(V,i))},[x,y]=t.useState(null),{formatMessage:u}=(0,O.Z)(),{trackUsage:F}=(0,v.rS)(),E=(0,R.I0)(),[$,A]=t.useState(s),[p,B]=(0,D.U$)(`stages.${o}.name`),[f,S]=(0,D.U$)(`stages.${o}.color`),[{handlerId:T,isDragging:W,handleKeyDown:Ke},Qe,Xe,Ye]=(0,Ie.Y9)(c,{index:o,item:{name:p.value},onGrabItem:m,onDropItem:w,onMoveItem:P,onCancel:C,type:d.uL.STAGE}),Je=(0,Me.FE)(Qe,Xe),Y=$e.map(({hex:i,name:V})=>({value:i,label:u({id:"Settings.review-workflows.stage.color.name",defaultMessage:"{name}"},{name:V}),color:i})),qe=Y.find(({value:i})=>i===f.value.toUpperCase());return t.createElement(k.x,{ref:Je},x&&t.createElement(ge.T,{"aria-live":"assertive"},x),W?t.createElement(Te,null):t.createElement(me.U,{size:"S",variant:"primary",onToggle:()=>{A(!$),$||F("willEditStage")},expanded:$,shadow:"tableShadow"},t.createElement(fe.B,{title:p.value,togglePosition:"left",action:t.createElement(t.Fragment,null,n&&t.createElement(j.h,{background:"transparent",icon:t.createElement(Ee.Z,null),label:u({id:"Settings.review-workflows.stage.delete",defaultMessage:"Delete stage"}),noBorder:!0,onClick:()=>E(le(e))}),t.createElement(j.h,{background:"transparent",forwardedAs:"div",role:"button",noBorder:!0,tabIndex:0,"data-handler-id":T,ref:Ye,label:u({id:"Settings.review-workflows.stage.drag",defaultMessage:"Drag"}),onClick:i=>i.stopPropagation(),onKeyDown:Ke},t.createElement(ke.Z,null)))}),t.createElement(ve.v,{padding:6,background:"neutral0",hasRadius:!0},t.createElement(pe.r,{gap:4},t.createElement(z.P,{col:6},t.createElement(Se.o,{...p,id:p.name,label:u({id:"Settings.review-workflows.stage.name.label",defaultMessage:"Stage name"}),error:B.error??!1,onChange:i=>{p.onChange(i),E(U(e,{name:i.target.value}))},required:!0})),t.createElement(z.P,{col:6},t.createElement(he.g,{error:S?.error??!1,name:f.name,id:f.name,required:!0},t.createElement(h.k,{direction:"column",gap:1,alignItems:"stretch"},t.createElement(we.Q,null,u({id:"content-manager.reviewWorkflows.stage.color",defaultMessage:"Color"})),t.createElement(v.JV,{components:{Option:De.K,SingleValue:Re.R},error:S?.error,inputId:f.name,name:f.name,options:Y,onChange:({value:i})=>{f.onChange({target:{value:i}}),E(U(e,{color:i}))},value:qe??{value:f.value,label:u({id:"Settings.review-workflows.stage.color.name.custom",defaultMessage:"Custom"}),color:f.value}}),t.createElement(ye.c,null))))))))}H.propTypes=g().shape({id:g().number.isRequired,color:g().string.isRequired,canDelete:g().bool.isRequired,canReorder:g().bool.isRequired,stagesCount:g().number.isRequired}).isRequired;const be=(0,I.ZP)(k.x)`
  position: relative;
`,xe=(0,I.ZP)(k.x)`
  left: 50%;
  position: absolute;
  top: 0;
  transform: translateX(-50%);
`;function Z({stages:e}){const{formatMessage:o}=(0,O.Z)(),n=(0,R.I0)(),{trackUsage:c}=(0,v.rS)();return t.createElement(h.k,{direction:"column",gap:6,width:"100%"},t.createElement(be,{spacing:4,width:"100%"},t.createElement(xe,{background:"neutral200",height:"100%",width:2,zIndex:1}),t.createElement(h.k,{direction:"column",alignItems:"stretch",gap:6,zIndex:2,position:"relative",as:"ol"},e.map((s,l)=>{const r=s?.id??s.__temp_key__;return t.createElement(k.x,{key:`stage-${r}`,as:"li"},t.createElement(H,{id:r,index:l,canDelete:e.length>1,isOpen:!s.id,canReorder:e.length>1,stagesCount:e.length}))}))),t.createElement(h.k,{direction:"column",gap:6},t.createElement(G,{type:"button",onClick:()=>{n(ie({name:""})),c("willCreateStage")}},o({id:"Settings.review-workflows.stage.add",defaultMessage:"Add new stage"}))))}Z.defaultProps={stages:[]},Z.propTypes={stages:g().arrayOf(g().shape({id:g().number,__temp_key__:g().number,name:g().string.isRequired}))};var K=a(97889),Ae=a(89793),Oe=a.n(Ae);const Q={status:"loading",serverState:{currentWorkflow:null,workflows:[]},clientState:{currentWorkflow:{data:null,isDirty:!1,hasDeletedServerStages:!1}}};function Le(e=Q,o){return(0,K.Uy)(e,n=>{const{payload:c}=o;switch(o.type){case d.QM:{const{status:s,workflows:l}=c;if(n.status=s,l?.length>0){let r=l[0];r={...r,stages:r.stages.map(m=>({...m,color:m?.color??d.FT}))},n.serverState.workflows=l,n.serverState.currentWorkflow=r,n.clientState.currentWorkflow.data=r,n.clientState.currentWorkflow.hasDeletedServerStages=!1}break}case d.x4:{const{stageId:s}=c,{currentWorkflow:l}=e.clientState;n.clientState.currentWorkflow.data.stages=l.data.stages.filter(r=>(r?.id??r.__temp_key__)!==s),l.hasDeletedServerStages||(n.clientState.currentWorkflow.hasDeletedServerStages=!!e.serverState.currentWorkflow.stages.find(r=>r.id===s));break}case d.Ot:{const{currentWorkflow:s}=e.clientState;s.data||(n.clientState.currentWorkflow.data={stages:[]});const l=Ze(n.clientState.currentWorkflow.data.stages);n.clientState.currentWorkflow.data.stages.push({...c,color:c?.color??d.FT,__temp_key__:l});break}case d.Nj:{const{currentWorkflow:s}=e.clientState,{stageId:l,...r}=c;n.clientState.currentWorkflow.data.stages=s.data.stages.map(m=>(m.id??m.__temp_key__)===l?{...m,...r}:m);break}case d.$k:{const{currentWorkflow:{data:{stages:s}}}=e.clientState,{newIndex:l,oldIndex:r}=c;if(l>=0&&l<s.length){const m=s[r];let w=[...s];w.splice(r,1),w.splice(l,0,m),n.clientState.currentWorkflow.data.stages=w}break}default:break}e.clientState.currentWorkflow.data&&(n.clientState.currentWorkflow.isDirty=!Oe()((0,K.Vk)(n.clientState.currentWorkflow).data,n.serverState.currentWorkflow))})}const Ze=(e=[])=>{const o=e.map(n=>n.id??n.__temp_key__);return Math.max(...o,-1)+1};function Pe(e,o){const n=(0,R.oR)();(0,t.useEffect)(()=>{n.injectReducer(e,o)},[n,e,o])}var Fe=a(67350),M=a(24346);function Be({formatMessage:e}){return M.Ry({stages:M.IX().of(M.Ry().shape({name:M.Z_().required(e({id:"Settings.review-workflows.validation.stage.name",defaultMessage:"Name is required"})).max(255,e({id:"Settings.review-workflows.validation.stage.max-length",defaultMessage:"Name can not be longer than 255 characters"})),color:M.Z_().required(e({id:"Settings.review-workflows.validation.stage.color",defaultMessage:"Color is required"})).matches(/^#(?:[0-9a-fA-F]{3}){1,2}$/i)}))})}var Ve=a(83983),Ne=a(16899);const Ue=(0,I.ZP)(h.k)`
  svg path {
    fill: ${({theme:e})=>e.colors.neutral600};
  }
`;function X({name:e}){return t.createElement(h.k,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",gap:3,hasRadius:!0,padding:3,shadow:"tableShadow",width:(0,v.Q1)(300)},t.createElement(Ue,{alignItems:"center",background:"neutral200",borderRadius:"50%",height:6,justifyContent:"center",width:6},t.createElement(Ne.Z,{width:`${8/16}rem`})),t.createElement(b.Z,{fontWeight:"bold"},e))}X.propTypes={name:g().string.isRequired};var Ge=a(55433);function je({type:e,item:o}){switch(e){case d.uL.STAGE:return t.createElement(X,{...o});default:return null}}function ze(){const{trackUsage:e}=(0,v.rS)(),{formatMessage:o}=(0,O.Z)(),n=(0,R.I0)(),{put:c}=(0,v.kY)(),{formatAPIError:s}=(0,v.So)(),l=(0,v.lm)(),{workflows:r,refetchWorkflow:m}=(0,Fe.n)(),{status:w,clientState:{currentWorkflow:{data:C,isDirty:P,hasDeletedServerStages:x}}}=(0,R.v9)(S=>S?.[d.sN]??Q),[y,u]=(0,t.useState)(!1),{mutateAsync:F,isLoading:E}=(0,J.useMutation)(async({workflowId:S,stages:T})=>{const{data:{data:W}}=await c(`/admin/review-workflows/workflows/${S}/stages`,{data:T});return W},{onSuccess(){l({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}})}}),$=async(S,T)=>{try{return await F({workflowId:S,stages:T})}catch(W){return l({type:"warning",message:s(W)}),null}},A=async()=>{await $(C.id,C.stages),await m(),u(!1)},p=async()=>{await A()},B=()=>{u(S=>!S)},f=(0,D.TA)({enableReinitialize:!0,initialValues:C,async onSubmit(){x?u(!0):A()},validationSchema:Be({formatMessage:o}),validateOnChange:!1});return Pe(d.sN,Le),(0,t.useEffect)(()=>{n(se({status:r.status,data:r.data}))},[r.status,r.data,n]),(0,t.useEffect)(()=>{e("didViewWorkflow")},[]),t.createElement(v.O4,{permissions:Ve.Z.settings["review-workflows"].main},t.createElement(q.A,null,t.createElement(v.SL,{name:o({id:"Settings.review-workflows.page.title",defaultMessage:"Review Workflows"})}),t.createElement(_.o,{tabIndex:-1},t.createElement(Ge.r,{renderItem:je}),t.createElement(D.Hy,{value:f},t.createElement(D.l0,{onSubmit:f.handleSubmit},t.createElement(ee.T,{primaryAction:t.createElement(te.z,{startIcon:t.createElement(ne.Z,null),type:"submit",size:"M",disabled:!P,loading:!y&&E},o({id:"global.save",defaultMessage:"Save"})),title:o({id:"Settings.review-workflows.page.title",defaultMessage:"Review Workflows"}),subtitle:o({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:C?.stages?.length??0})}),t.createElement(ae.D,null,w==="loading"&&t.createElement(oe.a,null,o({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})),t.createElement(Z,{stages:f.values?.stages})))),t.createElement(v.QH,{bodyText:{id:"Settings.review-workflows.page.delete.confirm.body",defaultMessage:"All entries assigned to deleted stages will be moved to the previous stage. Are you sure you want to save?"},isConfirmButtonLoading:E,isOpen:y,onToggleDialog:B,onConfirm:p}))))}var He=ze}}]);
